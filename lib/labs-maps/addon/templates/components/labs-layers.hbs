{{!-- Bind layer groups' layers --}}
{{#each visibleLayers key='id' as |layerObject|}}

  {{!-- if the layer is hightlightable or tooltipable, bind events --}}
  {{#if (or layerObject.highlightable layerObject.tooltipable)}}

    {{mapbox-gl-on 
      'mousemove' 
      layerObject.style.id 
      (action 'handleLayerMouseMove') 
      eventSource=map}}

    {{mapbox-gl-on 
      'mouseleave' 
      layerObject.style.id 
      (action 'handleLayerMouseLeave') 
      eventSource=map}}

  {{/if}}

  {{mapbox-gl-on 'click' layerObject.style.id (action 'handleLayerMouseClick') 
    eventSource=map}}

  {{mapbox-gl-layer 
      map=map 
      layer=layerObject.style}}

{{/each}}

{{!-- Highlighted Layer Handling --}}
{{#if hoveredFeature}}
  {{mapbox-gl-layer 
    map=map 
    layer=highlightedFeatureLayer}}
{{/if}}

{{yield (hash 
  tooltip=(if hoveredFeature 
    (component toolTipComponent 
      feature=hoveredFeature 
      layer=hoveredLayer 
      top=mousePosition.y 
      left=mousePosition.x
    )
  )
)}}
